<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bee Swarm Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;700&display=swap');
        :root { --bee-yellow: #fbbf24; --bee-orange: #f59e0b; }
        body { font-family: 'Lexend', sans-serif; background-color: #fffbeb; overscroll-behavior-y: contain; }
        
        .bee-gradient { background: linear-gradient(135deg, var(--bee-yellow) 0%, var(--bee-orange) 100%); }
        .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid #fef3c7; }
        .tab-active { border-bottom: 4px solid var(--bee-orange); color: #92400e; font-weight: 700; background: white; }
        .input-box { border: 2px solid #fde68a; border-radius: 12px; padding: 10px 16px; background: white; color: #78350f; font-weight: 600; outline: none; width: 100%; }
        .label-text { color: #92400e; font-size: 11px; font-weight: 800; text-transform: uppercase; margin-bottom: 6px; display: block; }
        
        .loading-pulse { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* AI Expert Specific Styling */
        .ai-bubble-expert { background: #eff6ff; color: #1e40af; border: 1px solid #dbeafe; border-radius: 12px; }
        .ai-bubble-user { background: #f8fafc; color: #334155; border: 1px solid #e2e8f0; border-radius: 12px; }
        .smart-scanner-area { border: 2px dashed #93c5fd; background: #f0f7ff; border-radius: 16px; transition: all 0.2s; }
        .smart-scanner-area:active { background: #e0efff; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center pb-12">

    <div class="w-full max-w-xl flex-grow flex flex-col">
        <!-- Header -->
        <div class="bee-gradient p-6 shadow-lg text-white text-center sticky top-0 z-50">
            <h1 class="text-2xl font-black flex items-center justify-center gap-2 tracking-tight"><span>üêù</span> BSS HUB</h1>
        </div>

        <!-- Tabs -->
        <div class="flex bg-amber-100/50 sticky top-[76px] z-40 border-b border-amber-200">
            <button onclick="switchTab('tickets')" id="tab-tickets" class="flex-1 py-5 text-[11px] uppercase font-black text-amber-700">Tickets</button>
            <button onclick="switchTab('treats')" id="tab-treats" class="flex-1 py-5 text-[11px] uppercase font-black text-amber-700 tab-active">Treats Calc</button>
            <button onclick="switchTab('ai')" id="tab-ai" class="flex-1 py-5 text-[11px] uppercase font-black text-amber-700">üíé AI Expert</button>
        </div>

        <div class="flex-grow p-4">
            <div class="card rounded-3xl shadow-2xl overflow-hidden mb-8">
                
                <!-- Ticket Section -->
                <div id="section-tickets" class="hidden p-6 space-y-8">
                    <div class="bg-amber-50 rounded-2xl p-5 border-2 border-amber-200">
                        <label class="label-text">Shop Ticket Price?</label>
                        <div class="flex gap-4">
                            <input type="number" id="quickCost" placeholder="e.g. 150000" class="flex-1 input-box">
                            <div id="calcBoughtCount" class="bg-white border-2 border-amber-200 px-5 py-2 rounded-xl font-black text-amber-600 flex items-center shadow-sm">0 Bought</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-5">
                        <div>
                            <label class="label-text">Owned Tickets</label>
                            <input type="number" id="owned" value="0" class="input-box">
                        </div>
                        <div>
                            <label class="label-text">How many to buy?</label>
                            <input type="number" id="toBuy" value="1" class="input-box">
                        </div>
                    </div>
                    <div class="bg-amber-500 rounded-2xl p-8 text-white text-center shadow-xl">
                        <div id="totalCost" class="text-3xl font-black">0 Honey</div>
                    </div>
                </div>

                <!-- Treats Section -->
                <div id="section-treats" class="p-6 space-y-6">
                    <div class="grid grid-cols-2 gap-5">
                        <div>
                            <label class="label-text">Target Level</label>
                            <input type="number" id="targetLevel" value="14" class="input-box">
                        </div>
                        <div>
                            <label class="label-text">Total Hive Slots</label>
                            <input type="number" id="beeCount" value="50" class="input-box">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-5">
                        <div>
                            <label class="label-text">Bond Per Treat</label>
                            <input type="number" id="bondPerTreat" value="10" class="input-box">
                        </div>
                        <div>
                            <label class="label-text">Treats in Inv.</label>
                            <input type="number" id="invTreats" value="0" class="input-box">
                        </div>
                    </div>

                    <div class="bg-white border-4 border-amber-100 rounded-3xl p-8 text-center shadow-md">
                        <div class="text-[11px] font-black text-amber-800 uppercase mb-1">Honey Needed</div>
                        <div id="honeyResult" class="text-4xl font-black text-amber-950">0 Honey</div>
                        <div id="calcDetails" class="text-[11px] font-bold text-amber-500 uppercase mt-2">Bond Needed: 0 | Treats Needed: 0</div>
                        <p class="text-[9px] text-amber-400 mt-4 italic font-bold">Calculation assumes all bees are currently Level (Target - 1)</p>
                    </div>
                </div>

                <!-- AI Expert Section -->
                <div id="section-ai" class="hidden flex flex-col h-[600px] bg-[#f8fafc]">
                    <div class="p-4 bg-white border-b border-slate-100">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-lg">üì∑</span>
                            <span class="font-bold text-slate-700 text-sm">Smart Progress Scanner</span>
                        </div>
                        <button onclick="document.getElementById('aiScannerInput').click()" class="border-2 border-dashed border-blue-300 bg-blue-50 w-full py-10 flex flex-col items-center justify-center gap-2 rounded-2xl">
                            <span class="text-blue-600 font-bold text-xs uppercase tracking-widest">Scan Hive or Gear</span>
                            <input type="file" id="aiScannerInput" accept="image/*" capture="camera" class="hidden">
                        </button>
                    </div>
                    <div id="aiChat" class="flex-grow p-4 overflow-y-auto space-y-4 text-sm">
                        <div class="bg-blue-100 text-blue-800 p-4 rounded-xl max-w-[90%]">Hello! I'm your BSS Expert. Ask me anything about your hive progress!</div>
                    </div>
                    <div class="p-4 bg-white border-t flex gap-2">
                        <input type="text" id="aiInput" placeholder="Ask a question..." class="flex-grow border p-2 rounded-lg outline-none">
                        <button onclick="sendAiMessage()" class="bg-blue-600 text-white px-4 rounded-lg">Send</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const apiKey = "AIzaSyBcxZZZt4TLdGfkAbCya1OyIAqYhPcvaCs";
        
        // Accurate Bond Data from User
        const BOND_DATA = {
            "1": 0, "2": 10, "3": 40, "4": 200, "5": 750, "6": 4000, 
            "7": 15000, "8": 60000, "9": 270000, "10": 450000, "11": 1200000, 
            "12": 2000000, "13": 4000000, "14": 7000000, "15": 15000000, 
            "16": 120000000, "17": 450000000, "18": 1900000000, "19": 7500000000, 
            "20": 15000000000, "21": 475000000000, "22": 4500000000000, 
            "23": 95000000000000, "24": 900000000000000, "25": 9000000000000000
        };

        function formatHoney(num) {
            if (num >= 1e15) return (num / 1e15).toFixed(2) + "Qd";
            if (num >= 1e12) return (num / 1e12).toFixed(2) + "T";
            if (num >= 1e9) return (num / 1e9).toFixed(2) + "B";
            if (num >= 1e6) return (num / 1e6).toFixed(2) + "M";
            return Math.floor(num).toLocaleString();
        }

        function calculateTreats() {
            const target = parseInt(document.getElementById('targetLevel').value) || 1;
            const beeCount = parseInt(document.getElementById('beeCount').value) || 0;
            const bondPerTreat = parseInt(document.getElementById('bondPerTreat').value) || 10;
            const invTreats = parseInt(document.getElementById('invTreats').value) || 0;

            // Bond needed for ONE bee to reach target level from (target-1)
            const bondForNextLevel = BOND_DATA[target] || 0;
            
            // Formula: ((10 * Bond * Bees) / BondPerTreat - Inventory) * 10000
            // Note: In game mechanics, 1 Treat = 10 Bond. 
            // The user formula includes a '10' multiplier in numerator, likely to cancel out the division by 'BondFromTreats' if it is 10.
            // But standard calculation is: (TotalBondNeeded / BondPerTreat) * CostPerTreat
            // Cost Per Treat = 10,000 Honey.
            
            const totalBondNeeded = bondForNextLevel * beeCount;
            const treatsNeeded = (totalBondNeeded / bondPerTreat) - invTreats;
            const finalHoney = Math.max(0, treatsNeeded * 10000);

            // Update UI
            document.getElementById('honeyResult').innerText = formatHoney(finalHoney) + " Honey";
            document.getElementById('calcDetails').innerText = `Bond Needed: ${formatHoney(totalBondNeeded)} | Treats Needed: ${formatHoney(Math.max(0, treatsNeeded))}`;
        }

        function switchTab(tab) {
            ['tickets', 'treats', 'ai'].forEach(t => {
                document.getElementById(`section-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
            });
            document.getElementById(`section-${tab}`).classList.remove('hidden');
            if (tab === 'ai') document.getElementById(`section-${tab}`).classList.add('flex');
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
        }

        document.getElementById('quickCost').oninput = (e) => {
            const p = parseFloat(e.target.value) || 0;
            if (p < 100000) return;
            const x = (p - 100000) / 1000;
            const n = Math.round(p < 500000 ? Math.pow(x, 1/1.2) : Math.pow(x, 1/1.7));
            document.getElementById('calcBoughtCount').innerText = n + " Bought";
            document.getElementById('owned').value = n;
            updateTickets();
        };

        function updateTickets() {
            const o = parseInt(document.getElementById('owned').value) || 0;
            const b = parseInt(document.getElementById('toBuy').value) || 1;
            let t = 0;
            for (let i = 0; i < b; i++) {
                let n = o + i;
                t += n < 501 ? 100000 + (1000 * Math.pow(n, 1.2)) : 100000 + (1000 * Math.pow(n, 1.7));
            }
            document.getElementById('totalCost').innerText = Math.floor(t).toLocaleString() + " Honey";
        }

        async function sendAiMessage() {
            const input = document.getElementById('aiInput');
            const chat = document.getElementById('aiChat');
            if(!input.value.trim()) return;
            const userText = input.value;
            chat.innerHTML += `<div class="flex justify-end"><div class="bg-slate-200 p-3 rounded-lg max-w-[85%] font-semibold">${userText}</div></div>`;
            input.value = "";
            chat.scrollTop = chat.scrollHeight;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `BSS Expert. User: ${userText}` }] }] })
                });
                const data = await res.json();
                chat.innerHTML += `<div class="bg-blue-100 p-3 rounded-lg max-w-[90%]">${data.candidates[0].content.parts[0].text}</div>`;
                chat.scrollTop = chat.scrollHeight;
            } catch (e) { chat.innerHTML += `<div class="text-red-500 text-xs text-center">Error connecting to AI.</div>`; }
        }

        ['targetLevel', 'beeCount', 'bondPerTreat', 'invTreats'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateTreats);
        });
        document.getElementById('owned').oninput = updateTickets;
        document.getElementById('toBuy').oninput = updateTickets;
        
        window.onload = () => {
            calculateTreats();
            updateTickets();
        };
    </script>
</body>
</html>