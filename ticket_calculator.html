<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bee Swarm Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;700&display=swap');
        
        :root {
            --bee-yellow: #fbbf24;
            --bee-orange: #f59e0b;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background-color: #fffbeb;
            overscroll-behavior-y: contain;
        }

        .bee-gradient {
            background: linear-gradient(135deg, var(--bee-yellow) 0%, var(--bee-orange) 100%);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #fef3c7;
        }

        input {
            font-size: 16px !important;
            min-height: 48px;
        }

        .tab-active {
            border-bottom: 4px solid var(--bee-orange);
            color: #92400e;
            font-weight: 700;
            background: white;
        }

        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: var(--bee-orange);
            border-radius: 10px;
        }

        .highlight-box {
            background: linear-gradient(to right, #fff7ed, #ffedd5);
            border: 2px solid #fdba74;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">

    <div class="w-full max-w-xl flex-grow flex flex-col">
        <!-- Sticky Header -->
        <div class="bee-gradient p-5 shadow-lg text-white text-center sticky top-0 z-50">
            <h1 class="text-2xl font-bold flex items-center justify-center gap-2">
                <span>üêù</span> BSS Multi-Calculator
            </h1>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex bg-amber-100/50 sticky top-[68px] z-40 border-b border-amber-200">
            <button onclick="switchTab('tickets')" id="tab-tickets" class="flex-1 py-4 text-xs uppercase tracking-widest font-bold text-amber-700 transition-all tab-active">
                Tickets
            </button>
            <button onclick="switchTab('treats')" id="tab-treats" class="flex-1 py-4 text-xs uppercase tracking-widest font-bold text-amber-700 transition-all">
                Treats & Levels
            </button>
        </div>

        <!-- Main Content Area -->
        <div class="flex-grow p-4 md:p-6">
            <div class="card rounded-2xl shadow-xl overflow-hidden">
                
                <!-- Ticket Section -->
                <div id="section-tickets" class="p-5 space-y-6">
                    
                    <!-- NEW Quick Lookup Question -->
                    <div class="highlight-box rounded-xl p-4 shadow-sm animate-in fade-in slide-in-from-top-4 duration-500">
                        <div class="flex items-center justify-between gap-4">
                            <div class="flex-1">
                                <label class="block text-[11px] font-black text-orange-900 mb-2 uppercase tracking-tight">How much does 1 ticket cost in your shop right now?</label>
                                <div class="relative">
                                    <input type="number" id="quickCost" placeholder="e.g. 150000"
                                        class="w-full px-4 py-2 rounded-lg border-2 border-orange-200 focus:border-orange-500 outline-none transition-all shadow-inner text-sm">
                                    <div class="absolute right-3 top-3 text-orange-300 pointer-events-none">üçØ</div>
                                </div>
                            </div>
                            <div class="text-center px-4 py-2 bg-white rounded-lg border-2 border-orange-100 min-w-[100px]">
                                <div class="text-[9px] font-bold text-orange-400 uppercase">You've Bought</div>
                                <div id="calcBoughtCount" class="text-lg font-black text-orange-600">0</div>
                                <div class="text-[8px] font-bold text-orange-400">TICKETS</div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4 pt-2">
                        <div>
                            <label class="block text-xs font-bold text-amber-900 mb-2 uppercase">Already Owned (n)</label>
                            <input type="number" id="owned" value="0" min="0" placeholder="0"
                                class="w-full px-4 rounded-xl border-2 border-amber-100 focus:border-amber-400 outline-none transition-all shadow-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-amber-900 mb-2 uppercase">Amount to Buy</label>
                            <input type="number" id="toBuy" value="1" min="1"
                                class="w-full px-4 rounded-xl border-2 border-amber-100 focus:border-amber-400 outline-none transition-all shadow-sm">
                        </div>
                    </div>

                    <div class="space-y-3">
                        <div class="bg-amber-50 rounded-xl p-4 border border-amber-100">
                            <div class="text-[10px] text-amber-700 font-bold uppercase mb-1">Cost of Next Ticket</div>
                            <div id="nextTicketPrice" class="text-xl font-bold text-amber-900">100,000</div>
                        </div>
                        <div class="bee-gradient rounded-xl p-5 shadow-md text-white">
                            <div class="text-[10px] font-bold uppercase opacity-90 mb-1">Total Cost for <span id="displayCount">1</span> Tickets</div>
                            <div id="totalCost" class="text-2xl font-bold">100,000</div>
                        </div>
                    </div>
                </div>

                <!-- Treats Section -->
                <div id="section-treats" class="hidden p-5 space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-amber-900 mb-2 uppercase">Target Lvl</label>
                            <input type="number" id="targetLevel" value="10" min="1"
                                class="w-full px-4 rounded-xl border-2 border-amber-100 focus:border-amber-400 outline-none shadow-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-amber-900 mb-2 uppercase">Bee Count</label>
                            <input type="number" id="beeCount" value="50" min="1"
                                class="w-full px-4 rounded-xl border-2 border-amber-100 focus:border-amber-400 outline-none shadow-sm">
                        </div>
                    </div>

                    <div class="bg-amber-50/50 p-4 rounded-xl border border-dashed border-amber-200 space-y-4">
                        <div>
                            <label id="labelOutlierCount" class="block text-[10px] font-bold text-amber-800 mb-2 uppercase">Bees NOT at target level?</label>
                            <input type="number" id="outlierCount" value="0" min="0"
                                class="w-full px-3 py-2 text-sm rounded-lg border border-amber-200 focus:border-amber-400 outline-none">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-amber-800 mb-2 uppercase">Levels (e.g. "8 5 7")</label>
                            <input type="text" id="outlierLevelsInput" 
                                class="w-full px-3 py-2 text-sm rounded-lg border border-amber-200 focus:border-amber-400 outline-none"
                                placeholder="Separated by spaces">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] font-bold text-amber-900 mb-2 uppercase">Bond/Treat</label>
                            <input type="number" id="bondPerTreat" value="10" min="1"
                                class="w-full px-4 rounded-xl border-2 border-amber-100 focus:border-amber-400 outline-none shadow-sm">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-amber-900 mb-2 uppercase">Inv. Treats</label>
                            <input type="number" id="inventoryTreats" value="0" min="0"
                                class="w-full px-4 rounded-xl border-2 border-amber-100 focus:border-amber-400 outline-none shadow-sm">
                        </div>
                    </div>

                    <div class="bg-white border-2 border-amber-100 rounded-xl p-5 shadow-sm text-center">
                        <div class="text-[10px] text-amber-700 font-bold uppercase mb-1">Honey Needed</div>
                        <div id="treatHoneyResult" class="text-2xl font-bold text-amber-900">0</div>
                        <div id="subtextCalculation" class="text-[9px] text-amber-500 mt-2 font-medium"></div>
                    </div>

                    <details class="bg-amber-50 rounded-xl border border-amber-100">
                        <summary class="p-3 text-xs font-bold text-amber-800 cursor-pointer uppercase text-center">View Bond Table</summary>
                        <div class="p-3 grid grid-cols-2 gap-2 text-[10px] border-t border-amber-100 custom-scroll overflow-y-auto max-h-40">
                            <div id="js-bond-list" class="col-span-2 grid grid-cols-2 gap-x-4"></div>
                        </div>
                    </details>
                </div>

                <div class="p-4 text-center text-[10px] text-amber-400 uppercase tracking-widest font-bold bg-white border-t border-amber-50">
                    BSS Calculator v2.1
                </div>
            </div>
        </div>
    </div>

    <script>
        const BOND_TABLE = {
            1: 0, 2: 10, 3: 40, 4: 200, 5: 750, 6: 4000, 7: 15000, 8: 60000, 9: 270000, 
            10: 450000, 11: 1200000, 12: 2000000, 13: 4000000, 14: 7000000, 15: 15000000, 
            16: 120000000, 17: 450000000, 18: 1900000000, 19: 7500000000, 20: 15000000000, 
            21: 475000000000, 22: 4500000000000, 23: 95000000000000, 24: 900000000000000, 25: 9000000000000000
        };

        const bondListDiv = document.getElementById('js-bond-list');
        Object.keys(BOND_TABLE).forEach(lv => {
            if (lv == 1) return;
            const item = document.createElement('div');
            item.className = "flex justify-between border-b border-amber-100 py-1";
            item.innerHTML = `<span>Lvl ${lv-1}‚Üí${lv}:</span> <span class="font-bold">${BOND_TABLE[lv].toLocaleString()}</span>`;
            bondListDiv.appendChild(item);
        });

        function switchTab(tab) {
            document.getElementById('section-tickets').classList.toggle('hidden', tab !== 'tickets');
            document.getElementById('section-treats').classList.toggle('hidden', tab !== 'treats');
            document.getElementById('tab-tickets').classList.toggle('tab-active', tab === 'tickets');
            document.getElementById('tab-treats').classList.toggle('tab-active', tab === 'treats');
            window.scrollTo(0,0);
        }

        function formatVal(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + "T";
            if (num >= 1e9) return (num / 1e9).toFixed(2) + "B";
            if (num >= 1e6) return (num / 1e6).toFixed(2) + "M";
            return Math.max(0, Math.floor(num)).toLocaleString();
        }

        // TICKET REVERSE LOGIC
        const quickCostIn = document.getElementById('quickCost');
        const calcBoughtEl = document.getElementById('calcBoughtCount');
        const ownedInput = document.getElementById('owned');

        function reverseTicketPrice() {
            const currentPrice = parseFloat(quickCostIn.value) || 0;
            if (currentPrice < 100000) {
                calcBoughtEl.innerText = "0";
                return;
            }

            const x = (currentPrice - 100000) / 1000;
            let n = 0;
            
            // Try formula for n < 501 first
            const nSmall = Math.round(Math.pow(x, 1 / 1.2));
            // Try formula for n >= 501
            const nLarge = Math.round(Math.pow(x, 1 / 1.7));

            if (nSmall <= 500) {
                n = nSmall;
            } else {
                n = nLarge;
            }

            calcBoughtEl.innerText = n.toLocaleString();
            ownedInput.value = n; // Sync with Already Owned
            updateTickets();
        }

        function calculateTicketPrice(n) {
            return n < 501 ? 100000 + (1000 * Math.pow(n, 1.2)) : 100000 + (1000 * Math.pow(n, 1.7));
        }

        function updateTickets() {
            const owned = parseInt(ownedInput.value) || 0;
            const toBuy = parseInt(document.getElementById('toBuy').value) || 0;
            const nextPrice = calculateTicketPrice(owned);
            document.getElementById('nextTicketPrice').innerText = formatVal(nextPrice) + " Honey";

            let total = 0;
            for (let i = 0; i < toBuy; i++) total += calculateTicketPrice(owned + i);
            document.getElementById('totalCost').innerText = formatVal(total) + " Honey";
            document.getElementById('displayCount').innerText = toBuy;
        }

        // TREAT LOGIC
        function updateTreats() {
            const targetLv = parseInt(document.getElementById('targetLevel').value) || 1;
            const totalBees = parseInt(document.getElementById('beeCount').value) || 0;
            const BT = parseFloat(document.getElementById('bondPerTreat').value) || 10;
            const INV = parseFloat(document.getElementById('inventoryTreats').value) || 0;

            document.getElementById('labelOutlierCount').innerText = `Bees NOT at level ${targetLv - 1}?`;

            const outliersCount = parseInt(document.getElementById('outlierCount').value) || 0;
            const outlierLevels = document.getElementById('outlierLevelsInput').value.trim().split(/\s+/)
                .map(v => parseInt(v)).filter(v => !isNaN(v)).slice(0, outliersCount);

            const validOutlierTotal = Math.min(outliersCount, totalBees);
            const standardBeesCount = Math.max(0, totalBees - validOutlierTotal);

            let totalWeightedBond = (BOND_TABLE[targetLv] || 0) * standardBeesCount;

            for (let i = 0; i < validOutlierTotal; i++) {
                const currentLv = outlierLevels[i] !== undefined ? outlierLevels[i] : (targetLv - 1);
                for (let lv = currentLv + 1; lv <= targetLv; lv++) {
                    totalWeightedBond += BOND_TABLE[lv] || 0;
                }
            }
            
            const treatsNeeded = (totalWeightedBond / BT) - INV;
            const result = treatsNeeded * 10000;

            document.getElementById('treatHoneyResult').innerText = formatVal(result) + " Honey";
            document.getElementById('subtextCalculation').innerText = `Total Bond: ${formatVal(totalWeightedBond)} | Treats: ${formatVal(treatsNeeded)}`;
        }

        // Listeners
        quickCostIn.addEventListener('input', reverseTicketPrice);
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', () => {
                if(input.id !== 'quickCost') updateTickets();
                updateTreats();
            });
        });

        updateTickets();
        updateTreats();
    </script>
</body>
</html>